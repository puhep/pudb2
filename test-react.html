<!--
  This is a test page.

  This page uses reach js to change the text in some inputs and save them.
  This will be something I, Chase, want to implement to the summary pages so you can click edit and edit a field.
  I think some JQuery will be needed to make the calls to the mySQL database.

  STILL TESTING.
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <title>React Testing</title>
  </head>
  <body>
    <script src="./node_modules/jquery/dist/jquery.js"></script>
    <script src="./js/getSheetInfo.js" charset="utf-8"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.11.0/es6-shim.min.js"></script>
    <script src="http://fb.me/react-with-addons-0.11.0.js"></script>
    <script src="http://fb.me/JSXTransformer-0.11.0.js"></script>

    <div class="wrapper">
      <header>
        <a href="index.php">
          <img src="../phase_2/pics/pu_logo.jpg" width="200" height="100" alt="Purude University Logo">
          <img src="../phase_2/pics/CMS_logo_col.gif" width="100" height="100" alt="CMS Logo">
        </a>
      </header>
      <nav>
        <a href="part_list.php">Part List</a>
        <br>
        <a href="test_list.php">Test List</a>
        <br>
        <a href="https://docs.google.com/document/d/1zDu6hiUR7r6qumQPcKdV3OXh7vLpGjodTjLopjbufKQ/edit?usp=sharing"> Project Logbook</a>
        <br>
        <a href="https://drive.google.com/drive/folders/0B04OIAGnMDYxbXBkTWJmMm5hN0E?usp=sharing">Project Google Drive</a>
        <br>
        <a href="contact.php">Contact/Issues</a>
      </nav>
      <main>
        <h1>Summary</h1>
        <div id="container"></div>
      </main>
    </div>

    <script type="text/jsx;harmony=true">/** @jsx React.DOM */
      var localArray = dbArray;
      var Comment = React.createClass({
        getInitialState: function() {
          return {editing: false, textVal: ''}
        },
        handleChange: function(evt) {
          this.setState({textVal: evt.target.value});
          console.log(this.state.textVal);
        },
        edit: function() {
          this.setState({editing: true});
        },
        remove: function() {
          alert('Removing Comment');
          this.props.deleteFromBoard(this.props.index);
        },
        save: function() {
          var val = this.state.textVal;
          this.props.updateCommentText(val, this.props.index);
          var field = this.props.field;
          var time = new Date();
          var h = time.getHours();
          var m = time.getMinutes();
          var s = time.getSeconds();
          var dd = time.getDate();
          var mm = time.getMonth() + 1;
          var yyyy = time.getFullYear();
          if (dd<10) dd='0'+dd;
          if (mm<10) mm='0'+mm;
          time = mm+'-'+dd+'-'+yyyy+' '+h+':'+m+':'+s;
          $(function() {
            $.ajax({
              url: './php/updatePart.php?id=6&partType=sheet&field=' + field +'&value=' + val,
              success: function() {
                console.log('success');
              },
            });
            $.ajax({
              url: './php/updatePart.php?id=6&partType=sheet&field=lastEdit&value=' + time,
            })
          });
          this.setState({editing: false});
        },
        renderNormal: function() {
          return (
            <div className="commentContainer">
              <div className="commentText">{this.props.children}</div>
              <button onClick={this.edit} className="button-primary">Edit</button>
              <button onClick={this.remove} className="button-danger">Remove</button>
            </div>
          );
        },
        renderForm: function() {
          return (
            <div className="commentContainer">
              <input placeholder={this.props.children} value={this.props.textVal} onChange={this.handleChange}></input>
              <br/>
              <button onClick={this.save} className="button-save">Save</button>
            </div>
          );
        },
        render: function() {
            if (this.state.editing) {
              return this.renderForm();
            } else {
              return this.renderNormal();
            }
        },
      });

      var Board = React.createClass({
        getInitialState: function() {
          // $.ajax({ url: 'react-data.php?id=3', success: test, });
          console.log(dbArray);
          return {
            comments: localArray
          }
        },
        removeComment: function(i) {
          console.log('Removing comment: ' + i);
          var arr = this.state.comments;
          arr.splice(i, 1);
          this.setState({comments: arr});
        },
        updateComment: function(newText, i) {
          console.log('Updating comment');
          var arr = this.state.comments;
          arr[i] = newText;
          this.setState({comments: arr});
        },
        eachComment: function (text, i) {
          return (
            <Comment key={i} index={i} updateCommentText={this.updateComment}  deleteFromBoard={this.removeComment}>
              {text}
            </Comment>
          );
        },
        render: function() {
          return (
            <div className="board">
              <table>
                <tr>
                  <td>Object Type</td><td>Sheet</td>
                </tr>
                <tr>
                  <td>Name</td>
                  <td>
                  <Comment key={0} index={0} field={name} updateCommentText={this.updateComment}  deleteFromBoard={this.removeComment}>
                    {localArray[0]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Location</td>
                  <td>
                  <Comment key={1} index={1} field={location} updateCommentText={this.updateComment}  deleteFromBoard={this.removeComment}>
                    {localArray[1]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Date Cut</td>
                  <td>
                  <Comment key={2} index={2} field={'dateCut'} updateCommentText={this.updateComment}  deleteFromBoard={this.removeComment}>
                    {localArray[2]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Ply</td>
                  <td>
                  <Comment key={3} index={3} field={'ply'} updateCommentText={this.updateComment}  deleteFromBoard={this.removeComment}>
                    {localArray[3]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Mass Before Backing</td>
                  <td>
                    <Comment key={4} index={4} field={'mass_nb'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[4]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Cut By</td>
                  <td>
                    <Comment key={5} index={5} field={'user_cut'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[5]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Date put int Oven</td>
                  <td>
                    <Comment key={6} index={6} field={'dateOven'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[6]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Bagged/Oven Turned on By</td>
                  <td>
                    <Comment key={7} index={7} field={'user_bagged'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[7]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Number of Wax Coats</td>
                  <td>
                    <Comment key={8} index={8} field={'num_wax_coats'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[8]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Number of Times bag was used previously</td>
                  <td>
                    <Comment key={9} index={9} field={'bagUseTimes'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[9]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Curing Stackup</td>
                  <td>
                    <Comment key={10} index={10} field={'curing_stackup'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[10]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time of Oven Start</td>
                  <td>
                    <Comment key={11} index={11} field={'ovenStart'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[11]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time Reach 107</td>
                  <td>
                    <Comment key={12} index={12} field={'ovenReach107'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[12]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Checked (1) By</td>
                  <td>
                  <Comment key={13} index={13} field={'user_check1'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[13]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time Began Ramping</td>
                  <td>
                    <Comment key={14} index={14} field={'timeRamp'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[14]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Ramped up By</td>
                  <td>
                    <Comment key={15} index={15} field={'user_ramp'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[15]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time Reached 177</td>
                  <td>
                    <Comment key={16} index={16} field={'ovenReach177'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[16]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Checked (2) By</td>
                  <td>
                  <Comment key={17} index={17} field={'user_check2'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[17]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time Shut off</td>
                  <td>
                  <Comment key={18} index={18} field={'timeOvenOff'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[18]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Checked (3) By</td>
                  <td>
                  <Comment key={19} index={19} field={'user_check3'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[19]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Time Removed</td>
                  <td>
                  <Comment key={20} index={20} field={'timeRemoved'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[20]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Removed By</td>
                  <td>
                  <Comment key={21} index={21} field={'user_remove'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[21]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Length Outside</td>
                  <td>
                  <Comment key={22} index={22} field={'lengthOutside'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[22]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Length Inside</td>
                  <td>
                  <Comment key={23} index={23} field={'lengthInside'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[23]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Height Outside</td>
                  <td>
                  <Comment key={24} index={24} field={'heightOutside'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[24]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Height Inside</td>
                  <td>
                  <Comment key={25} index={25} field={'heightInside'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[25]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Mass After</td>
                  <td>
                    <Comment key={26} index={26} field={'mass_after'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                      {localArray[26]}
                    </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Edge Thicknesses 1</td>
                  <td>
                  <Comment key={27} index={27} field={'thickness1'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[27]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Edge Thickness 2</td>
                  <td>
                  <Comment key={28} index={28} field={'thickness2'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[28]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Edge Thickness 3</td>
                  <td>
                  <Comment key={29} index={29} field={'thickness3'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[29]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Edge Thickness 4</td>
                  <td>
                  <Comment key={30} index={30} field={'thickness4'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[30]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Bow</td>
                  <td>
                  <Comment key={31} index={31} field={'bow'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[31]}
                  </Comment>
                  </td>
                </tr>
                <tr>
                  <td>Measured by</td>
                  <td>
                  <Comment key={32} index={32} field={'user_measure'} updateCommentText={this.updateComment} deleteFromBoard={this.removeComment}>
                    {localArray[32]}
                  </Comment>
                  </td>
                </tr>
              </table>
            </div>

          );
        },
      });
      React.renderComponent(

        <Board />,
        document.getElementById('container')
      );
    </script>
  </body>
</html>
