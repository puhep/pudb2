<!--
  This is a test page.

  This page uses reach js to change the text in some inputs and save them.
  This will be something I, Chase, want to implement to the summary pages so you can click edit and edit a field.
  I think some JQuery will be needed to make the calls to the mySQL database.

  WORKS NOW!
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <title>React Testing</title>
  </head>
  <body>
    <script src="./node_modules/jquery/dist/jquery.js"></script>
    <script src="./js/getSheetInfo.js" charset="utf-8"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/es6-shim/0.11.0/es6-shim.min.js"></script>
    <script src="http://fb.me/react-with-addons-0.11.0.js"></script>
    <script src="http://fb.me/JSXTransformer-0.11.0.js"></script>

    <div class="wrapper">
      <header>
        <a href="index.php">
          <img src="../phase_2/pics/pu_logo.jpg" width="200" height="100" alt="Purude University Logo">
          <img src="../phase_2/pics/CMS_logo_col.gif" width="100" height="100" alt="CMS Logo">
        </a>
      </header>
      <nav>
        <a href="part_list.php">Part List</a>
        <br>
        <a href="test_list.php">Test List</a>
        <br>
        <a href="https://docs.google.com/document/d/1zDu6hiUR7r6qumQPcKdV3OXh7vLpGjodTjLopjbufKQ/edit?usp=sharing"> Project Logbook</a>
        <br>
        <a href="https://drive.google.com/drive/folders/0B04OIAGnMDYxbXBkTWJmMm5hN0E?usp=sharing">Project Google Drive</a>
        <br>
        <a href="contact.php">Contact/Issues</a>
      </nav>
      <main>
        <h1>Summary</h1>
        <div id="container"></div>
      </main>
    </div>

    <script type="text/jsx;harmony=true">/** @jsx React.DOM */
      var test;
      var id = 6;
      $.ajax({
        url: 'php/getSheetData.php?id=' + id,
        success: fun,
      }).fail(function() {
        console.log('failed');
      });
      function fun(response) {
        JSONtoArray(response);
        console.log(dbArray);

      var localArray = dbArray;
      var Comment = React.createClass({
        getInitialState: function() {
          return {editing: false, textVal: ''}
        },
        handleChange: function(evt) {
          this.setState({textVal: evt.target.value});
          console.log(this.state.textVal);
        },
        edit: function() {
          this.setState({editing: true});
        },
        save: function() {
          var val = this.state.textVal;
          this.props.updateCommentText(val, this.props.index);
          var field = this.props.field;
          var time = new Date();
          var h = time.getHours();
          var m = time.getMinutes();
          var s = time.getSeconds();
          var dd = time.getDate();
          var mm = time.getMonth() + 1;
          var yyyy = time.getFullYear();
          if (dd<10) dd='0'+dd;
          if (mm<10) mm='0'+mm;
          time = mm+'-'+dd+'-'+yyyy+' '+h+':'+m+':'+s;
          $(function() {
            $.ajax({
              url: './php/updatePart.php?id=6&partType=sheet&field=' + field +'&value=' + val,
              success: function() {
                console.log('success');
              },
            });
            $.ajax({
              url: './php/updatePart.php?id=6&partType=sheet&field=lastEdit&value=' + time,
            })
          });
          this.setState({editing: false});
        },
        renderNormal: function() {
          return (
            <div className="commentContainer">
              <table>
                <tr>
                  <td>
                    <div className="commentText">{this.props.children}</div>
                  </td>
                  <td>
                    <button onClick={this.edit} className="button-primary">Edit</button>
                  </td>
                </tr>
                </table>
            </div>
          );
        },
        renderForm: function() {
          return (
            <div className="commentContainer">
              <input placeholder={this.props.children} value={this.props.textVal} onChange={this.handleChange}></input>
              <br/>
              <button onClick={this.save} className="button-save">Save</button>
            </div>
          );
        },
        render: function() {
            if (this.state.editing) {
              return this.renderForm();
            } else {
              return this.renderNormal();
            }
        },
      });

      var Board = React.createClass({
        getInitialState: function() {
          return {
            comments: dbArray
          }
        },
        updateComment: function(newText, i) {
          console.log('Updating comment');
          var arr = this.state.comments;
          arr[i] = newText;
          this.setState({comments: arr});
        },
        eachComment: function (text, i) {
          return (
            <tr>
              <td>
                {keyArray[i]}
              </td>
              <td>
                <Comment key={i} index={i} updateCommentText={this.updateComment}>
                {text}
                </Comment>
              </td>
            </tr>
          );
        },
        render: function() {
          return (
            <div className="board">
              <table>
                <tr>
                  <td>Last Edit</td>
                  <td>{dbJSON.lastEdit}</td>
                </tr>
                <tr>
                  <td>Object Type</td>
                  <td>Sheet</td>
                </tr>
                {this.state.comments.map(this.eachComment)}
              </table>
            </div>

          );
        },
      });
      React.renderComponent(

        <Board />,
        document.getElementById('container')
      );
    }
    </script>
  </body>
</html>
